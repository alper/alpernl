{{ $currentPage := .page }}
<nav class="flex flex-wrap gap-4 text-sm">
  {{ range .page.Site.Menus.main }}
    {{ $active := or ($currentPage.IsMenuCurrent "main" .) ($currentPage.HasMenuCurrent "main" .) }}
    {{ $active = or $active (eq $currentPage.RelPermalink .URL) }}
    {{ $active = or $active (and $currentPage.IsPage (eq $currentPage.Type .Identifier)) }}
    {{ $active = or $active (and (ne .URL "/") (eq $currentPage.Section (strings.TrimPrefix "/" (strings.TrimSuffix "/" .URL)))) }}

    <a href="{{ .URL | relURL }}"
       class="flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-colors duration-200
              {{ if $active }}
                bg-gray-300 text-gray-900 dark:bg-gray-700 dark:text-white
              {{ else }}
                text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-800
              {{ end }}">
      {{ with .Pre }}<span class="text-lg">{{ . | safeHTML }}</span>{{ end }}
      <span>{{ or .Title .Name }}</span>
    </a>
  {{ end }}
</nav>
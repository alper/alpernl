<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>MySQL encoding mistakes corrupting data in this decade?!? :: alper.nl - Example site for hugo-theme-tailwind</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="Turns out I hadn&rsquo;t noticed my hosting provider Vimexx has their MySQL databases on latin1 coding and this blog was running on that happily corrupting data.
Given how common an occurrence this is—MySQL very regularly will throw your shit into the street and set fire to it—I had expected there being scripts or resources to fix this. Of course nothing was to be found anywhere.
I asked the Mastodon MySQL expert who did have a resource on the exact problem: https://blog.koehntopp.info/2020/08/18/mysql-character-sets.html "
/>
<meta
  name="keywords"
  content="hugo, tailwind, tailwindcss, hugo theme, hugo theme tailwind"
/>
<meta name="robots" content="noodp" /><link rel="manifest" href="/manifest.json" /><meta property="og:url" content="http://localhost:1313/blog/17649/">
  <meta property="og:site_name" content="alper.nl">
  <meta property="og:title" content="MySQL encoding mistakes corrupting data in this decade?!?">
  <meta property="og:description" content="Turns out I hadn’t noticed my hosting provider Vimexx has their MySQL databases on latin1 coding and this blog was running on that happily corrupting data.
Given how common an occurrence this is—MySQL very regularly will throw your shit into the street and set fire to it—I had expected there being scripts or resources to fix this. Of course nothing was to be found anywhere.
I asked the Mastodon MySQL expert who did have a resource on the exact problem: https://blog.koehntopp.info/2020/08/18/mysql-character-sets.html">
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-11-03T14:55:25+00:00">
    <meta property="article:modified_time" content="2024-11-03T14:55:25+00:00">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="MySQL encoding mistakes corrupting data in this decade?!?">
  <meta name="twitter:description" content="Turns out I hadn’t noticed my hosting provider Vimexx has their MySQL databases on latin1 coding and this blog was running on that happily corrupting data.
Given how common an occurrence this is—MySQL very regularly will throw your shit into the street and set fire to it—I had expected there being scripts or resources to fix this. Of course nothing was to be found anywhere.
I asked the Mastodon MySQL expert who did have a resource on the exact problem: https://blog.koehntopp.info/2020/08/18/mysql-character-sets.html">


<link rel="canonical" href="http://localhost:1313/blog/17649/" />

<link rel="shortcut icon" href="/favicon.ico" />
<link rel="stylesheet" href="/css/index.c3a5d1586276a68cf55558ab67f2c726fee27f4aea3add1802872f471c5f233d.css">









  
  

</head>
<body class="flex flex-col min-h-screen w-full bg-slate-50 dark:bg-gray-800">
    
<div class="fixed right-0 top-0 z-50 flex items-center justify-center bg-gray-200 p-2 text-sm uppercase text-black sm:bg-red-200 md:bg-yellow-200 lg:bg-green-200 xl:bg-blue-200 2xl:bg-pink-200">
  <span class="block sm:hidden">all</span>
  <span class="hidden sm:block md:hidden">sm</span>
  <span class="hidden md:block lg:hidden">md</span>
  <span class="hidden lg:block xl:hidden">lg</span>
  <span class="hidden xl:block 2xl:hidden">xl</span>
  <span class="hidden 2xl:block">2xl</span>
</div>

  <header class="flex flex-none justify-center z-10">
    <div class="flex flex-row gap justify-between w-full max-w-4xl lg:max-w-5xl h-12 mt-3">
  <div class="flex-none ml-2 md:ml-0">
    <a href="/" class="">
      <img class="h-12 w-12 rounded-full object-cover bg-gray-100" src="https://placehold.co/512/webp" alt="logo">
    </a>
  </div>
  
  <div class="flex-1"></div>
  <div class="flex-none">
    




  </div>
  
  <div class="flex-none mx-1"></div>
  
  <div class="flex-none md:hidden">
    <a href=/search/ class="inline-flex items-center p-2 text-sm text-slate-800 dark:text-slate-200 rounded-lg" aria-controls="navbar-menu" aria-expanded="false">
      <span class="sr-only">Search</span>
      <i class="w-8 h-8">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
    <path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" />
    <path d="M21 21l-6 -6" />
</svg>

      </i>
    </a>
  </div>
  <div class="darkmode-toggle flex flex-none mr-2 md:mr-0">
    <label for="darkmode-toggle" class="relative flex items-center gap-1 px-3 cursor-pointer rounded-full bg-gray-100 dark:bg-gray-600" title="Toggle dark mode">
      <input name="darkmode-toggle" id="darkmode-toggle" type="checkbox" class="sr-only peer" aria-label="Toggle dark mode">
      <div class="absolute z-10 w-15 h-8 rounded-full bg-white dark:bg-gray-700"></div>
      <i class="h-6 w-6 z-20 ml-1 flex-none rounded-full bg-yellow-400 place-self-center peer-checked:invisible">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brightness-down" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"></path>
   <path d="M12 5l0 .01"></path>
   <path d="M17 7l0 .01"></path>
   <path d="M19 12l0 .01"></path>
   <path d="M17 17l0 .01"></path>
   <path d="M12 19l0 .01"></path>
   <path d="M7 17l0 .01"></path>
   <path d="M5 12l0 .01"></path>
   <path d="M7 7l0 .01"></path>
</svg>

      </i>
      <i class="h-6 w-6 z-20 mr-1 flex-none rounded-full place-self-center invisible peer-checked:visible">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon-stars" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
   <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
   <path d="M19 11h2m-1 -1v2"></path>
</svg>

      </i>
    </label>
  </div>
</div>

  </header>
  <main class="flex flex-auto justify-center">
    
<div id="progress" class="fixed top-0 left-0 w-full h-1 bg-blue-500"></div>
<div class="w-full max-w-4xl lg:max-w-5xl">
  <div class="flex flex-col mt-6 mx-2 md:mx-0 rounded-lg overflow-hidden shadow-md bg-white dark:bg-gray-700">
    <div>
      <a href="/blog/17649/">
        
      </a>
    </div>
    <div class="flex flex-col gap-y-3 p-6">
      <h1 class="text-4xl font-semibold text-slate-800 dark:text-slate-100">
        <a href="/blog/17649/">MySQL encoding mistakes corrupting data in this decade?!?</a>
      </h1>

      
      
  <ul class="flex flex-row flex-wrap text-slate-500 dark:text-slate-300">
    
      
      <li>
        <a href="/categories/english/"
          class="text-sm mr-2 px-2 py-1 rounded-sm border border-emerald-800 bg-emerald-800 text-slate-50">
          English
        </a>
      </li>
      
      <li>
        <a href="/categories/internet/"
          class="text-sm mr-2 px-2 py-1 rounded-sm border border-emerald-800 bg-emerald-800 text-slate-50">
          Internet
        </a>
      </li>
      
      <li>
        <a href="/categories/software-engineering/"
          class="text-sm mr-2 px-2 py-1 rounded-sm border border-emerald-800 bg-emerald-800 text-slate-50">
          Software-Engineering
        </a>
      </li>
      
    
    
  </ul>



      <div class="flex flex-col gap-y-1 md:flex-row md:gap-y-0 md:gap-x-4 text-slate-500 dark:text-slate-300">
  
  
  <div class="flex flex-row text-base gap-x-1">
    <i class="h-6 w-6 flex-none">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12z"></path>
   <path d="M16 3v4"></path>
   <path d="M8 3v4"></path>
   <path d="M4 11h16"></path>
   <path d="M11 15h1"></path>
   <path d="M12 15v3"></path>
</svg>

    </i>
    <time datetime="2024-11-03T14:55:25&#43;00:00">
      2024-11-03
    </time>
  </div>
</div>

      

      

      <article class="mt-6 w-full max-w-4xl lg:max-w-5xl prose prose-slate dark:prose-invert prose-quoteless post-content">
        <p>Turns out I hadn&rsquo;t noticed my hosting provider <a href="https://www.vimexx.nl" target="_blank" rel="noopener">Vimexx</a>
 has their MySQL databases on <code>latin1</code> coding and this blog was running on that happily corrupting data.</p>
<p>Given how common an occurrence this is—MySQL very regularly will throw your shit into the street and set fire to it—I had expected there being scripts or resources to fix this. Of course nothing was to be found anywhere.</p>
<p>I asked <a href="https://infosec.exchange/@isotopp" target="_blank" rel="noopener">the Mastodon MySQL expert</a>
 who did have a resource on the exact problem: <a href="https://blog.koehntopp.info/2020/08/18/mysql-character-sets.html" target="_blank" rel="noopener">https://blog.koehntopp.info/2020/08/18/mysql-character-sets.html</a>
</p>
<p>The way I fixed it was a bit more manual than I&rsquo;d have liked but where I got is good enough and I&rsquo;m not sure I&rsquo;ll go for anything perfect:</p>
<p>Go to the phpMyAdmin and audit all the database tables.</p>
<figure><img src="/blog/17649/CleanShot-2024-11-03-at-16.05.26@2x.png">
</figure>

<p>My tables are in a mix of InnoDB and MyISAM which seems to be weird but not really problematic. I also had some <a href="https://yoast.com" target="_blank" rel="noopener">Yoast</a>
 tables that were lingering there which I dropped.</p>
<p>Find the setting and convert all tables and their columns to the collation <code>utf8mb4_unicode_ci</code>. A collation implies the <code>utf8mb4</code> character set that is its prefix so you don&rsquo;t have to change the character set.</p>
<p>Now all your stuff is in UTF-8 but because of a coding error a lot of your content is messed up. A unicode character can be more than one byte but in latin1 each character can only be a single byte. So if your unicode character is two bytes, they are interpreted as two <code>latin1</code> characters which is why you end up with stuff like &quot; <strong>Ã®</strong>&quot;.</p>
<p>Maybe there would have been a clean automatic way to convert the data, but I felt it was fiddly enough as it was, so I opted for a manual fix. I identified where the corruption happened:</p>
<ul>
<li><code>wp_posts</code> columns <code>post_content</code> and <code>post_title</code></li>
<li><code>wp_comments</code> column <code>comment_content</code></li>
<li><code>wp_usermeta</code> column <code>meta_value</code></li>
</ul>
<p>Then I just ran queries to fix all the mismatches:</p>
<p>Ã¼ → ü<br>
Ãœ → Ü<br>
Ã© → é<br>
Ã‰ → É<br>
ÄŸ → ğ<br>
Ã‡ → Ç<br>
etc.</p>
<p>Luckily in almost all cases the wrong coded string is unique and can simply be replaced with the right character.</p>
<p>Check if a string is in the column:<br>
<code>SELECT post_content from wp_posts where post_content LIKE BINARY '%Ã‡%' and post_status='publish'</code></p>
<p>Later on check for specific characters and their environment in what can be very long post bodies:<br>
<code>SELECT SUBSTRING(post_content, LOCATE('Ã', post_content)-15, 40), post_content from wp_posts where post_content LIKE BINARY '%Ã%' and post_status='publish'</code></p>
<p>Replace the wrong string sequence with the correct character:<br>
<code>UPDATE wp_posts SET post_content = REPLACE(post_content, 'Ã‡', 'Ç') WHERE INSTR(post_content, 'Ã‡') &gt; 0</code></p>
<p>After some hours of auditing and pounding SQL most of the things should be fixed and whatever&rsquo;s left I can live with.</p>
<h2 id="conclusion">Conclusion</h2>
<p>The moral of this story is that the entire complex of Wordpress/PHP/MySQL is a pile of shit that should be burnt off the face of the planet. The fact that we can have these kind of encoding issues in the year 2024 shows what an absolute joke these systems are. Especially with the Mullenweg meltdowns, anybody who can get out of Wordpress should do so.</p>
<p>This blog hasn&rsquo;t received a comment or other bit of interactivity in years so I think I could also rip all the content (effectively just two columns in <code>wp_posts</code>) out and host it on something that&rsquo;s statically built. No reason to pay for a shit hosting provider like Vimexx anymore either.</p>

      </article>

      

    </div>
  </div>
</div>

  </main>
  <footer class="flex flex-none justify-center">
    <section class="flex flex-col md:flex-row mx-2 md:mx-0 gap-2 md:gap-0 justify-between w-full max-w-4xl lg:max-w-5xl py-6 text-slate-500 dark:text-slate-300">
  <div class="flex flex-row">
    
  
  
  
  
  
  
  
  
  
  
  


  </div>
  <div class="grow"></div>
  <div class="flex flex-row">
    <i class="h-6 w-6 flex-none"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"></path>
   <path d="M14 9.75a3.016 3.016 0 0 0 -4.163 .173a2.993 2.993 0 0 0 0 4.154a3.016 3.016 0 0 0 4.163 .173"></path>
</svg>
</i> 2023 - 2025 
    
  </div>
  
  <div class="flex flex-row">
    <span class="ml-0 pl-0 md:ml-2 md:pl-2 border-l-0 md:border-l border-slate-300 dark:border-slate-400">
      Powered by <a href="https://gohugo.io" target="_blank" rel="noopener" class="underline">Hugo</a> <span class="text-red-600">&hearts;</span> <a href="https://github.com/tomowang/hugo-theme-tailwind" target="_blank" rel="noopener" class="underline">Tailwind</a>
    </span>
  </div>
  
</section>

  </footer>
  <script src="/main.js"></script>




</body>
</html>
